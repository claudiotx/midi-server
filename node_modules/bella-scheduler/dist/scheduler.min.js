// bella-scheduler@1.2.2, by @ndaidong - built on Mon, 07 Aug 2017 06:33:29 GMT - published under MIT license
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.scheduler={})}(this,function(e){"use strict";var t,n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=Number.MAX_SAFE_INTEGER,i=function(e){return{}.toString.call(e)},u=function(e){return"[object Undefined]"===i(e)},o=function(e,t){return!(!e||!t)&&Object.prototype.hasOwnProperty.call(e,t)},s=function(e,t){if((!e||e<0)&&(e=0),t||(t=a),e===t)return t;e>t&&(e=Math.min(e,t),t=Math.max(e,t));var n=e,r=t-e+1;return Math.floor(Math.random()*r)+n},f=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="abcdefghijklmnopqrstuvwxyz",r=[n,n.toUpperCase(),"0123456789"].join("").split("").sort(function(){return Math.random()>.5}).join(""),a=r.length,i=Math.max(e||32,t.length),u=t;u.length<i;){var o=s(0,a);u+=r.charAt(o)||""}return u},c=function(){return new Date},l=function(){return Date.now()},d=function(e,t){var n=0,r=l()-t;if(!e)return-1;var a=parseInt(e[1],10),i=e[2];return"s"===i?n=1e3:"m"===i?n=6e4:"h"===i?n=36e5:"d"===i&&(n=864e5),(n*=a)-r},h=function(e,t){for(var n=-1,r=0;r<e.length;r++)if(e[r]===t){n=r;break}return n},v=function(e,t){var n=new Date(e);return n.setDate(n.getDate()+t+7-n.getDay()%7),n},m=function(e){var t="sun|mon|tue|wed|thu|fri|sat".split("|"),n=c(),r=t[n.getDay()],a=h(r,t),i=e[1].toLowerCase(),u=h(i,t),o=0,s=0,f=0;e[2]&&(o=parseInt(e[2],10)),e[3]&&(s=parseInt(e[3].replace(/\D/gi,""),10)),e[4]&&(f=parseInt(e[4].replace(/\D/gi,""),10)),n.setHours(o),n.setMinutes(s),n.setSeconds(f);var d=n.getTime(),m=l(),p=n;return(u<a||m>d)&&(p=v(n,a)),p.setHours(o),p.setMinutes(s),p.setSeconds(f),p.getTime()-m},p=function(e){var t="*"===e[1]?"*":parseInt(e[1],10),n="*"===e[2]?"*":parseInt(e[2],10),r="*"===e[3]?"*":parseInt(e[3],10),a="*"===e[4]?"*":parseInt(e[4],10),i="*"===e[5]?"*":parseInt(e[5],10),u="*"===e[6]?"*":parseInt(e[6],10),o=c(),s=o.getFullYear();if("*"!==t&&t<s)return-1;var f=t,d=n,h=r,v=a,m=i,p=u;"*"===t&&(f=s);var g=o.getMonth()+1;"*"===n&&(d=g);var y=o.getDate();"*"===r&&(h=y);var T=o.getHours();"*"===a&&(v=T);var w=o.getMinutes();"*"===i&&(m=w);var M=new Date(f,d-1,h,v,m,p),b=M.getTime(),D=l(),I=b-D;return I<0&&"*"===i&&(M.setMinutes(m+1),I=(b=M.getTime())-D),I<0&&"*"===a&&(M.setHours(v+1),I=(b=M.getTime())-D),I<0&&"*"===r&&(M.setDate(h+1),I=(b=M.getTime())-D),I<0&&"*"===n&&(M.setMonth(d),I=(b=M.getTime())-D),I<0&&"*"===t&&(M.setFullYear(f+1),I=(b=M.getTime())-D),I},g=new(function(){function e(){n(this,e),this.size=0,this.data={}}return r(e,[{key:"set",value:function(e,t){var n=this.data;return o(n,e)||this.size++,n[e]=t,this}},{key:"get",value:function(e){return this.data[e]||null}},{key:"all",value:function(){var e=this.data,t=[];for(var n in e)u(e[n])||t.push(e[n]);return t}},{key:"remove",value:function(e){var t=this.data;return!!o(t,e)&&(t[e]=null,delete t[e],this.size--,!0)}}]),e}()),y=function(e,t){var n=/^(\d+)\s?(d|h|m|s)+$/i,r=/^(sun|mon|tue|wed|thu|fri|sat)+\w*\s+(\d+)(:\d+)?(:\d+)?$/i,a=/^(\*|\d+)\s+(\*|\d+)\s+(\*|\d+)\s+(\*|\d+)\s+(\*|\d+)\s+(\d+)$/i,i=e.match(n);return i?d(i,t):(i=e.match(r))?m(i):(i=e.match(a))?p(i):-1},T=function(e){e.fn();var t=e.id;if(!e.repeat)return g.remove(t);var n=l();return e.lastTick=n,g.set(t,e),!0},w=function e(){if(t&&clearTimeout(t),g.size>0){var n=2147483647,r=[];g.all().forEach(function(e){var t=e.id,a=y(e.time,e.lastTick);if(a<0)g.remove(t);else if(0===a)e.delay=0,r.push(e);else if(e.delay=a,g.set(t,e),a<=n){n=a;var i=[];i=r.concat(e),r=i.filter(function(e){return e.delay<=n})}}),r.length&&(t=setTimeout(function(){r.map(T),setTimeout(e,1)},n))}},M=function(e,t,n){var r=n?0:1,a=l(),i=f(32),u={id:i,fn:t,time:e,repeat:r,createdAt:a,lastTick:a,delay:0};return g.set(i,u),w(),i};e.yearly=function(e,t){return M("* "+e,t)},e.monthly=function(e,t){return M("* * "+e,t)},e.daily=function(e,t){return M("* * * "+e,t)},e.hourly=function(e,t){return M("* * * * "+e,t)},e.every=function(e,t){return M(e,t)},e.once=function(e,t){return M(e,t,1)},e.unregister=function(e){return!!g.remove(e)&&(w(),!0)},Object.defineProperty(e,"__esModule",{value:!0})});